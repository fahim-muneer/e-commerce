{% extends "base.html" %}

{% block content %}
{% load static %}

<div class="bg-gray-100  py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-4 gap-6 mb-5">
        {% comment %} <div class="md:col-span-1 bg-white rounded-xl shadow-lg p-6 h-fit sticky top-8"> {% endcomment %}
            {% include "user_profile_side_bar.html" %}
        {% comment %} </div> {% endcomment %}

        <div class="md:col-span-3">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="border-b pb-4 mb-4 border-gray-200">
                    <h1 class="text-xl font-bold text-gray-800">My List</h1>
                </div>

                {% if wishlist_items %}
                {% for item in wishlist_items %}
                <div class="space-y-4">
                    <div class="flex items-center gap-4 border border-gray-200 rounded-xl p-4">
                        <img src="{{item.products.image1.url}}" alt="{{item.products.name}}" class="w-24 h-24 object-cover rounded-lg">
                        <div class="flex-1">
                            <h3 class="text-sm text-gray-500">{{item.products.name}}</h3>
                            <h2 class="text-lg font-semibold text-gray-800">{{item.products.description}}</h2>
                            
                            <div class="flex items-center mt-1 text-yellow-400">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                <svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                            </div>
                            
                            <div class="flex items-center mt-2">
                                <span class="text-xl font-bold text-gray-800">₹{{item.products.get_display_price}}</span>
                                <span class="text-sm text-gray-500 line-through ml-2">₹{{item.products.old_price}}</span>
                            </div>
                        </div>
                        
                        <div class="flex flex-col items-end gap-2">
                            <form method="post" action="{% url 'delete_item' pid=item.id %}">
                                {% csrf_token %}
                                <input type="hidden" name="delete" value="{{item.id}}">
                                <button type="submit" class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-3.707-9.293a1 1 0 00-1.414 1.414L8.586 12l-2.707 2.707a1 1 0 001.414 1.414L10 13.414l2.707 2.707a1 1 0 001.414-1.414L11.414 12l2.707-2.707a1 1 0 00-1.414-1.414L10 10.586 7.293 7.879a1 1 0 00-1.414 1.414z" clip-rule="evenodd"></path></svg>
                                </button>
                            </form>

                            <form method="post" action="{% url 'add_to_cart' %}" class="space-y-4">
                                {% csrf_token %}
                                <input type="hidden" name="product_id" value="{{ item.products.id }}">
                                <input type="hidden" name="quantity" value="1">

                                {% if item.products.variant.exists %}
                                    <!-- Include the first variant by default -->
                                    <input type="hidden" name="variant_id" value="{{ item.products.variant.first.id }}">
                                {% endif %}
                             {% if item.products.block %}
                            <p class="block w-full py-2 mt-2 bg-white-500 text-red-600 text-sm font-semibold text-center rounded-md">
                            Currently Unavailable
                                </p>

                                {% else %}
                                <button type="submit" class="w-full py-3 bg-red-500 text-white font-semibold rounded-md shadow-md hover:bg-red-600 transition-colors duration-200">
                                    <p class="text-lg">ADD TO CART</p> 
                                </button>
                                {% endif %}
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div>
                    <p class="font-bold text-lg text-red-500">No selected products are there.</p>
                </div>
                {% endif %}
            </div>

            <!-- Pagination-->
            {% if wishlist_items %}          
            {% if wishlist_items.paginator.num_pages %}
            <div class="flex justify-center space-x-2 mt-8">
                {% if wishlist_items.has_previous %}
                <a href="?page={{ wishlist_items.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" 
                   class="px-4 py-2 border rounded-md text-gray-700 hover:bg-gray-100">&lt;</a>
                {% endif %}

                {% for i in wishlist_items.paginator.page_range %}
                <a href="?page={{ i }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" 
                   class="px-4 py-2 border rounded-md text-gray-700 hover:bg-gray-100 {% if i == wishlist_items.number %}bg-blue-100 text-blue-600{% endif %}">{{ i }}</a>
                {% endfor %}

                {% if wishlist_items.has_next %}
                <a href="?page={{wishlist_items.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" 
                   class="px-4 py-2 border rounded-md text-gray-700 hover:bg-gray-100">&gt;</a>
                {% endif %}
            </div>
            {% endif %}
            {% endif %}
        </div>
    </div>
</div>

{% endblock content %}